# 关联分析

## 关联分析

**定义**：寻找数据项间感兴趣的关联关系，用关联规则的形式描述。

**举例**：“购买篮球的顾客中有 70% 购买篮球服”，这句话表明了“篮球”和“篮球服”之间存在关联规则，寻找关联规则的过程就是关联分析。

## 关联规则

### 1. 项

**定义**：数据集中的某一个元素。

项类似于数据集中的属性而不是具体的元素。比如“篮球”是一个项，不是说某个具体的🏀是一个项，而是说“篮球”作为一个整体是一个项。

### 2. 全项集

**定义**：所研究的对象数据集中所有项的集合，是一个非空有限集，记为 Σ = {i1, i2, ..., im, ...,ip}，其中 im(m=1, 2, ..., p)是一个项。

### 3. 项集

**定义**：全项集的子集，记为 I。

项集中项的数目称为**项集的长度**。一个长度为 k 的项集称为 **k-项集**。

### 4. 关联规则

**定义**：关联规则是形如 `X⇒Y[Interest]` 的表达式，X、Y为项集，X⊆Σ, Y⊆Σ，且X∩Y=Φ，X 称为**输入**或**左部**(LHS)，Y 称为**输出**或**右部**(RHS)，用兴趣度度量(Interest)评估关联规则。

**举例**：“购买篮球的顾客中有 70% 购买篮球服”这句话可用关联规则描述为：`篮球⇒篮球服[70%]` 。

数据集中有限的项能产生大量的关联规则，如何才能找到有效的方式获得我们需要的关联规则呢？

### 5. 兴趣度度量

**定义**：评估关联规则的一系列定义，包括评估关联规则的实用性（规则再次出现的可能性，支持度）、正确性（规则令人信服的程度，置信度）、简洁性（可解释程度）、新颖性（冗余规则）。

#### （1）支持度

**定义**：对关联规则重要性的衡量，反映关联是否是普遍存在的说明规则 X⇒Y 在所有交易中有多大代表性（普

遍程度）。即在所有交易中X与Y同时出现的概率，记为：`support(X⇒Y)` = `P(X∪Y)`。

**举例**：某体育用品商场九月份的 7000 笔销售交易中，购买篮球的交易有 1000 笔，购买篮球同时购买了篮球服的交易有 700 笔，有关联规则“篮球⇒篮球服”，其支持度为：

```shell
support(篮球⇒篮球服)
= P(篮球∪篮球服) 
= N(购买篮球同时购买了篮球服的交易) / N(总交易) * 100% 
= 700 / 7000  * 100% 
= 10%
```

#### （2）置信度

**定义**：是对关联规则准确度的衡量度量关联规则的强度，反映规则 X⇒Y 的必然性有多大。即在所有出现了X的交易中出现Y的概率，记为：`confidence(X⇒Y)` = `P(Y|X)`

**举例**：某体育用品商场九月份的 7000 笔销售交易中，购买篮球的交易有 1000 笔，购买篮球同时购买了篮球服的交易有 700 笔，有关联规则“篮球⇒篮球服”，其置信度为：

```shell
confidence(篮球⇒篮球服)
= P(篮球服|篮球)
= N(购买篮球同时购买了篮球服的交易) / N(购买篮球的交易) * 100% 
= 700 / 1000  * 100% 
= 70%
```

支持度和置信度的特点：

- **支持度高、置信度高**的规则多数情况是正确的且可经常使用。
- 置信度高，但支持度很低，说明规则虽准确，但并不普遍。
- 支持度越大，规则越重要，应用越广。
- 支持度的缺点：许多潜在的有意义的模式由于包含支持度小的项而被删去，比如很少人购买珠宝，但关于它的关联规则可能是商家所关心的。
- 置信度的缺点：高置信度并不代表规则是有意义的，往往是因为忽略了后件的支持度数。


#### （3）最小置信度阈值

**定义**：规则的最低可靠度。

#### （4）最小支持度阈值

**定义**：规则的最低普遍程度。

#### （5）强关联规则

**定义**：同时满足最小支持度阈值和最小置信度阈值的关联规则。

#### （6）频繁项集（Frequent Itemset）

**定义**：支持度大于等于最小支持度阈值的项集。

满足频繁项集的 k-项集称为 **k-频繁项集**，记为Lk。

#### （7）非频繁项集

**定义**：支持度大于最小支持度阈值的项集。

### 6. 支持度——置信度框架

**定义**：给定一个数据集D，**关联分析**即**挖掘关联规则问题**就是产生支持度和置信度分别大于给定的最小支持度阈值(min_sup)最小置信度阈值(min_conf)的**关联规则**。

**问题**：支持度——置信度框架存在一定的缺陷。

#### （1）期望可信度（Expected Confidence）

**定义**：描述对于关联规则`X=>Y`，在没有任何条件影响时，Y 在所有交易中出现的概率 `P(Y)`。即没有 X 的作用下，Y 本身的支持度。

#### （2）改善度（Lift）

**定义**：描述 X 的出现对 Y 的出现影响多大，是置信度与期望可信度的比值：`P(Y|X)/P(Y)` 。改善度越高，X 出现对 Y 出现的可能性影响越大。

只有置信度大于期望可信度，才说明 X 的出现对 Y 的出现有促进作用，也说明它们之间存在某种程度的相关性。即改善都应该大于1。当改善度小于1时，说明二者存在负相关性。

**举例**：假设零售商调查 10000 名顾客购买什么商品，得到的结果是 6000 名顾客购买篮球，7500 名顾客购买足球，4000 名顾客购买篮球、足球。设最小支持度为 30%，最小置信度为 60%，则有如下关联规则：

`篮球⇒足球(支持度=40%，置信度=66%)`

然而实际购买足球的可能性是 75%，大于 66%。

**解释**：这是因为购买篮球和购买足球形成了一种负相关，即购买其中一种反而减少了购买另一种的可能性，在这种情况下，要过滤这样具有误导性的“强”关联规则 `篮球⇒足球` 。规则中的期望可信度为 75%，改善度 = 66% / 75% < 1，表明购买篮球对购买足球没有促进作用。

### 7. 关联规则分类

#### （1）基于规则中涉及的数据的维数：

- 单维关联规则：`篮球⇒篮球服`

- 多维关联规则：`性别=“男性”⇒购买=“篮球”`

#### （2）基于规则中数据的抽象层次：

- 单层关联规则：`篮球⇒篮球服`

- 多层关联规则：`篮球⇒鸿星尔克篮球服`

#### （3）基于规则中处理的数据的类型：

- 布尔关联规则：`篮球⇒篮球服`


- 量化关联规则：`性别=“男性”⇒平均收入=“2300”`


### 8. 关联规则挖掘算法

大多数关联规则挖掘算法通常采用的策略：将关联规则的挖掘任务分解为如下两个子任务：

- 频繁项集的生成：发现满足最小支持度阈值的项集，如 Apriori 算法、FP-Growth 算法
- 关联规则的生成：从上一步发现的频繁项集中提取所有高置信度的规则

#### （1）由频繁项集生成关联规则

① 对于每个频繁项集 FI，找出 FI 的所有非空子集；

② 对于 FI 的每个非空子集 SFI，如果 support_count(FI) / support_count(SFI) ≥ min_conf，则输出规则 `SFI⇒(FI－SFI)`。

因为规则由频繁项集产生，所以每个规则都自动满足最小支持度阈值；且这两个项集 ` (SFI, FI-SFI)` 的支持度计数已在频繁项集产生时得到，因此不需再扫描整个数据集。

**举例**：最小置信度阈值为 50%，给定交易数据集如下表：

| 交易号  |    项集    |
| :--: | :------: |
| T100 | I1，I2，I5 |
| T200 |  I2，I4   |
| T300 |  I2，I3   |
| T400 | I1，I2，I4 |
| T500 |  I1，I3   |
| T600 |  I2，I3   |
| T700 |  I1，I3   |
| T900 | I1，I2，I3 |

已知该交易数据库中包含**频繁项集** FI={I1,I2,I5}，则 FI 的**非空子集**有：{I1,I2},{I1,I5},{I2,I5},{I1},{I2},{I5}，则可能的**关联规则**如下所示：

```shell
I1∧I2⇒I5 (2/4=50%)
I1∧I5⇒I2 (100%)
I2∧I5⇒I1 (100%)
I1⇒I2∧I5 (33%)
I2⇒I1∧I5 (29%)
I5⇒I1∧I2 (100%)
```

#### （2）置信度剪枝

如果规则 `X⇒Y-X` 不满足置信度阈值，则形如 `X'⇒Y-X'`的规则也一定不满足置信度阈值，其中 X' 是 X 的子集。




> CREATED on 26th November, 2021



>  UPDATED on 26th November, 2021

